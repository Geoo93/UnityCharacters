using UnityEngine;
using System.Collections;
using System.Collections.Generic;

public class BarrelController : MonoBehaviour {
	
	public GameObject BarrelsPrefab;
	public static List<ExplodingBarrel> BarrelObjects = new List<ExplodingBarrel>();
	public Weapon_Sniper weapon_Sniper;
	public static bool AppStart = true;
	
	private Texture2D StartSplash, RespawnSplash;
	private bool Respawning;
	
	void Awake() {
		StartSplash = (Texture2D)Resources.Load("Intro/Loading");
		RespawnSplash = (Texture2D)Resources.Load("Intro/BarrelRespawnSplash");
	}

	void Start () {
		StartCoroutine(RespawnBarrelsWithMessage(10, AppStart));
	}
	
	void Update () {
		if(Input.GetKeyDown(KeyCode.F1)) {
			if(Weapon_Sniper.IsAktive())
				StartCoroutine(RespawnBarrelsWithMessage(1, false));
		}
	}
	
	IEnumerator RespawnBarrelsWithMessage(int YieldFrames, bool appStart) {
		AppStart = appStart;
		
		if(!appStart) {
			Respawning = true;
			weapon_Sniper.Aktivate(false);
		}
		
 		for (int i=0; i<YieldFrames; i++) {
    		yield return null;
    	}
		
		RespawnBarrels();
		
		if(!appStart) {
			Respawning = false;
			weapon_Sniper.Aktivate(true);
		} else {
			AppStart = false;
		}
	}
	
	void RespawnBarrels() {
			
		foreach(ExplodingBarrel EB in BarrelObjects) {
			if(EB != null)
				Destroy(EB.gameObject);
		}
			
		BarrelObjects.Clear();
		BarrelObjects = new List<ExplodingBarrel>();
			
		Instantiate(BarrelsPrefab,transform.position, transform.rotation);
	}
	
	void OnGUI() {
		if(!AppStart && !Respawning)
			return;
		
		GUI.depth = 500;
		
		if(AppStart) {
			if(Event.current.type.Equals(EventType.Repaint))
				Graphics.DrawTexture(new Rect(0, 0, Screen.width, Screen.height), StartSplash);
		}
		
		if(Respawning) {
			if(Event.current.type.Equals(EventType.Repaint))
				Graphics.DrawTexture(new Rect(0, 0, Screen.width, Screen.height), RespawnSplash);
		}
	}
}
