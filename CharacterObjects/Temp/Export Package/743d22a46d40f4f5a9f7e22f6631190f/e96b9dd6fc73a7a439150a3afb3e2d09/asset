using UnityEngine;
using System.Collections;

public class ShockWave : MonoBehaviour {
	
	public Material ShockWaveMaterial;
	public GameObject ShockWaveSpherePrefab;
	private GameObject ShockWaveSphere;
    private float Duration = 1.25f;
    private float MaxSize = 120.0f;
	
    private float _elapsedTime = 0;
	private bool AKTIV;

    void Awake()
  	{
		AKTIV = false;
    }
	
    void Update()
    {
		if(AKTIV) {
	        _elapsedTime += Time.deltaTime;
			if (_elapsedTime > Duration)
	        {
				Destroy(ShockWaveSphere);
	            Destroy(this.gameObject);
	            return;
	        }
			ShockWaveSphere.renderer.sharedMaterial.SetFloat("_Transparency", 1 - _elapsedTime / Duration);
			ShockWaveSphere.transform.localScale = Vector3.one * (MaxSize * (_elapsedTime / Duration));
		}
    }
	
	public void SpawnShockWave(Vector3 position)
    {
		ShockWaveSphere = Instantiate(ShockWaveSpherePrefab, transform.position, Quaternion.identity) as GameObject;
		ShockWaveSphere.renderer.sharedMaterial = Instantiate(ShockWaveMaterial) as Material;
		ShockWaveSphere.transform.rotation = Quaternion.identity;
        ShockWaveSphere.layer = LayerMask.NameToLayer("TransparentFX");
		ShockWaveSphere.renderer.castShadows = false;
		ShockWaveSphere.renderer.receiveShadows = false;
        ShockWaveSphere.transform.position = position;
		
		ShockWaveSphere.transform.localScale = Vector3.zero;
        ShockWaveSphere.renderer.sharedMaterial.SetFloat("_Transparency", 1);
        AKTIV = true;
    }
}
